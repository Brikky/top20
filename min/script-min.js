function reload(){window.location.reload()}function shake(t){var e=document.getElementById(t),n=100,s=10,i=4;this.$(e).css("position","relative");for(var o=0;o<i+1;o++)this.$(e).animate({left:o%2==0?s:s*-1},n);this.$(e).animate({left:0},n)}function bounce(t){var e=document.getElementById(t),n=100,s=10,i=4;this.$(e).css("position","relative");for(var o=0;o<i+1;o++)this.$(e).animate({top:o%2==0?s:s*-1},n);this.$(e).animate({top:0},n)}function Song(t){this.name=t.name,this.preview_url=t.url||t.preview_url}function Player(t){this.name=t||"",this.guess="",this.score=0,this.$score_value=$("#score-value")}function Game(t,e){this.maxRoundLength=30,this.roundCount=0,this.roundStart=this.now(),this.roundTime=0,this.players=t||[],this.songs=e||[],this.winStatements=["You got it!","Watch out, Adele!","I thought it was The Beatles...","Keep it going!","Highest score EVER?","Lightning Round!","That's my favorite song!","Rockstar!","Notice me Senpai.","Call 911! 'Cuz you are on FIRE","You're my hero.","Making Beyonce proud!","Grand Prize!","That one took me a second.","OK. But can you get the next one?","I bet you make babies smile.","Stylin'!","DANCE BREAK","Me 'What's your number?' You: 'Number 1.'","Annie are you OK?!"].shuffle()}Game.prototype.cacheDom=function(){this.$document=$(document),this.$display=this.$document.find("#display"),this.$audio=this.$document.find("audio"),this.$song_guess=this.$document.find("#song-guess"),this.$start_button=this.$document.find("#start"),this.$restart_button=this.$document.find("#restart"),this.$visualizer=this.$document.find("#visualizer")},Game.prototype.currentPlayer=function(){return this.players[this.roundCount%this.players.length]},Game.prototype.currentWinStatement=function(){return this.winStatements[this.roundCount%this.winStatements.length]},Game.prototype.currentSong=function(){return this.songs[this.roundCount%this.songs.length]},Game.prototype.currentSongName=function(){return this.currentSong().name},Game.prototype.cleanString=function(t){var e=t.replace(/\s*\(.*?\)\s*/g,"").replace(/[^\w\s]|_/g,"").replace(/feat.*this.$/g,"");return e.trim(),e},Game.prototype.checkGuess=function(){if(this.players.length>0){var t=this.cleanString(this.currentSongName()),e=this.cleanString(this.$song_guess.val());return console.log(t),new RegExp(t,"i").test(e)}},Game.prototype.checkEnd=function(){return this.roundCount==this.songs.length&&this.roundCount>0},Game.prototype.endGame=function(){this.checkEnd()&&(this.$display.html(this.currentWinStatement()),this.$audio.attr("src","#"),this.$song_guess.hide(),this.$visualizer.hide(),this.$restart_button.show(),this.$restart_button.on("click touchstart",reload))},Game.prototype.handleCorrect=function(){this.currentPlayer().incrementScore(),this.$display.html(this.currentWinStatement()),bounce("display")},Game.prototype.handleMissed=function(){this.$display.html("You missed '"+this.currentSongName()+"'"),shake("display")},Game.prototype.handleRound=function(){this.roundTime=this.getRoundLength(),this.checkGuess()&&this.roundTime<=this.maxRoundLength?(this.handleCorrect(),this.newRound()):this.roundTime>this.maxRoundLength&&(this.handleMissed(),this.newRound())},Game.prototype.newRound=function(){this.roundCount++,this.roundStart=this.now(),this.$song_guess.val(""),this.$audio.attr("src",this.currentSong().preview_url)},Game.prototype.beginGame=function(){this.$document.on("keyup",this.handleRound.bind(this)),this.players.push(new Player(this.$song_guess.val())),this.$start_button.hide(),this.$song_guess.val(""),this.$song_guess.focus(),this.$song_guess.attr("placeholder","guess the song name"),this.$audio.attr("src",this.currentSong().preview_url),this.$visualizer.show(),this.roundStart=this.now(),this.$display.html("You have "+this.maxRoundLength+" seconds for each song.")},Game.prototype.initialize=function(){var t=this;this.cacheDom(),this.$start_button.on("click touchstart",this.beginGame.bind(this)),this.$restart_button.hide(),this.$visualizer.hide(),setInterval(this.checkTime.bind(this),100),setInterval(this.endGame.bind(this),100),$.ajax({type:"GET",url:"https://api.spotify.com/v1/search?q=year:2016&type=track",success:function(e){t.songs=e.tracks.items.shuffle()}})},Game.prototype.isLastRound=function(){return this.roundCount>0&&this.roundCount+1!=this.songs.length},Game.prototype.isRoundOver=function(){return this.getRoundLength()>this.maxRoundLength},Game.prototype.checkTime=function(){!this.isLastRound()&&this.isRoundOver()?(this.handleMissed(),this.newRound()):!this.isLastRound()&&this.getRoundLength()>25&&this.$display.html(this.maxRoundLength-Math.trunc(this.getRoundLength()))},Game.prototype.now=function(){return $.now()/1e3},Game.prototype.getRoundLength=function(){return this.players.length>0?this.now()-this.roundStart:-1},Player.prototype.incrementScore=function(){this.score++,this.$score_value.html(this.score)},Array.prototype.shuffle=function(){for(var t=this.length,e,n;0!==t;)n=Math.floor(Math.random()*t),t-=1,e=this[t],this[t]=this[n],this[n]=e;return this};